digraph D {
    fontname="Helvetica"
    fontsize=10

    node [fontname="Helvetica", fontsize=10, shape=plaintext]
    edge [fontname="Helvetica", fontsize=9]

    rankdir=LR; // Можно изменить на TB для вертикальной ориентации

    User [label=<
        <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
            <TR><TD COLSPAN="2" BGCOLOR="#4CAF50"><FONT COLOR="WHITE">User</FONT></TD></TR>
            <TR><TD PORT="id" CELLPADDING="2">id</TD><TD ALIGN="LEFT">Integer (PK, Index)</TD></TR>
            <TR><TD CELLPADDING="2">username</TD><TD ALIGN="LEFT">String(50) (Unique, Index, NN)</TD></TR>
            <TR><TD CELLPADDING="2">email</TD><TD ALIGN="LEFT">String(100) (Unique, Index, NN)</TD></TR>
            <TR><TD CELLPADDING="2">full_name</TD><TD ALIGN="LEFT">String(255)</TD></TR>
            <TR><TD CELLPADDING="2">hashed_password</TD><TD ALIGN="LEFT">String(255) (NN)</TD></TR>
            <TR><TD CELLPADDING="2">is_active</TD><TD ALIGN="LEFT">Boolean (Default True)</TD></TR>
            <TR><TD CELLPADDING="2">is_premium</TD><TD ALIGN="LEFT">Boolean (Default False)</TD></TR>
            <TR><TD CELLPADDING="2">role</TD><TD ALIGN="LEFT">String(50) (Default "listener", NN)</TD></TR>
            <TR><TD CELLPADDING="2">created_at</TD><TD ALIGN="LEFT">DateTime (Default UTC Now)</TD></TR>
            <TR><TD CELLPADDING="2">updated_at</TD><TD ALIGN="LEFT">DateTime (Default UTC Now)</TD></TR>
        </TABLE>>];

    Artist [label=<
        <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
            <TR><TD COLSPAN="2" BGCOLOR="#2196F3"><FONT COLOR="WHITE">Artist</FONT></TD></TR>
            <TR><TD PORT="id" CELLPADDING="2">id</TD><TD ALIGN="LEFT">Integer (PK, Index)</TD></TR>
            <TR><TD PORT="user_id" CELLPADDING="2">user_id</TD><TD ALIGN="LEFT">Integer (FK, Unique, Index)</TD></TR>
            <TR><TD CELLPADDING="2">name</TD><TD ALIGN="LEFT">String(255) (NN, Index)</TD></TR>
            <TR><TD CELLPADDING="2">bio</TD><TD ALIGN="LEFT">Text</TD></TR>
            <TR><TD CELLPADDING="2">country</TD><TD ALIGN="LEFT">String(100)</TD></TR>
            <TR><TD CELLPADDING="2">image_url</TD><TD ALIGN="LEFT">String(500)</TD></TR>
            <TR><TD CELLPADDING="2">spotify_id</TD><TD ALIGN="LEFT">String(100) (Unique)</TD></TR>
            <TR><TD CELLPADDING="2">created_at</TD><TD ALIGN="LEFT">DateTime (Default UTC Now)</TD></TR>
        </TABLE>>];

    Album [label=<
        <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
            <TR><TD COLSPAN="2" BGCOLOR="#FF9800"><FONT COLOR="WHITE">Album</FONT></TD></TR>
            <TR><TD PORT="id" CELLPADDING="2">id</TD><TD ALIGN="LEFT">Integer (PK, Index)</TD></TR>
            <TR><TD CELLPADDING="2">title</TD><TD ALIGN="LEFT">String(255) (NN, Index)</TD></TR>
            <TR><TD PORT="artist_id" CELLPADDING="2">artist_id</TD><TD ALIGN="LEFT">Integer (FK, NN)</TD></TR>
            <TR><TD CELLPADDING="2">release_date</TD><TD ALIGN="LEFT">DateTime</TD></TR>
            <TR><TD CELLPADDING="2">cover_image_url</TD><TD ALIGN="LEFT">String(500)</TD></TR>
            <TR><TD CELLPADDING="2">spotify_id</TD><TD ALIGN="LEFT">String(100) (Unique)</TD></TR>
            <TR><TD CELLPADDING="2">created_at</TD><TD ALIGN="LEFT">DateTime (Default UTC Now)</TD></TR>
        </TABLE>>];

    Genre [label=<
        <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
            <TR><TD COLSPAN="2" BGCOLOR="#9C27B0"><FONT COLOR="WHITE">Genre</FONT></TD></TR>
            <TR><TD PORT="id" CELLPADDING="2">id</TD><TD ALIGN="LEFT">Integer (PK, Index)</TD></TR>
            <TR><TD CELLPADDING="2">name</TD><TD ALIGN="LEFT">String(100) (Unique, NN, Index)</TD></TR>
            <TR><TD CELLPADDING="2">description</TD><TD ALIGN="LEFT">Text</TD></TR>
        </TABLE>>];

    Track [label=<
        <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
            <TR><TD COLSPAN="2" BGCOLOR="#FFEB3B"><FONT COLOR="BLACK">Track</FONT></TD></TR>
            <TR><TD PORT="id" CELLPADDING="2">id</TD><TD ALIGN="LEFT">Integer (PK, Index)</TD></TR>
            <TR><TD CELLPADDING="2">title</TD><TD ALIGN="LEFT">String(255) (NN, Index)</TD></TR>
            <TR><TD PORT="artist_id" CELLPADDING="2">artist_id</TD><TD ALIGN="LEFT">Integer (FK, NN)</TD></TR>
            <TR><TD PORT="album_id" CELLPADDING="2">album_id</TD><TD ALIGN="LEFT">Integer (FK)</TD></TR>
            <TR><TD PORT="genre_id" CELLPADDING="2">genre_id</TD><TD ALIGN="LEFT">Integer (FK)</TD></TR>
            <TR><TD CELLPADDING="2">duration_ms</TD><TD ALIGN="LEFT">Integer</TD></TR>
            <TR><TD CELLPADDING="2">file_path</TD><TD ALIGN="LEFT">String(500)</TD></TR>
            <TR><TD CELLPADDING="2">file_url</TD><TD ALIGN="LEFT">String(500)</TD></TR>
            <TR><TD CELLPADDING="2">spotify_id</TD><TD ALIGN="LEFT">String(100) (Unique)</TD></TR>
            <TR><TD CELLPADDING="2">preview_url</TD><TD ALIGN="LEFT">String(500)</TD></TR>
            <TR><TD CELLPADDING="2">explicit</TD><TD ALIGN="LEFT">Boolean (Default False)</TD></TR>
            <TR><TD CELLPADDING="2">popularity</TD><TD ALIGN="LEFT">Integer (Default 0)</TD></TR>
            <TR><TD CELLPADDING="2">tempo</TD><TD ALIGN="LEFT">Float</TD></TR>
            <TR><TD CELLPADDING="2">energy</TD><TD ALIGN="LEFT">Float</TD></TR>
            <TR><TD CELLPADDING="2">valence</TD><TD ALIGN="LEFT">Float</TD></TR>
            <TR><TD CELLPADDING="2">danceability</TD><TD ALIGN="LEFT">Float</TD></TR>
            <TR><TD CELLPADDING="2">created_at</TD><TD ALIGN="LEFT">DateTime (Default UTC Now)</TD></TR>
        </TABLE>>];

    Playlist [label=<
        <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
            <TR><TD COLSPAN="2" BGCOLOR="#00BCD4"><FONT COLOR="WHITE">Playlist</FONT></TD></TR>
            <TR><TD PORT="id" CELLPADDING="2">id</TD><TD ALIGN="LEFT">Integer (PK, Index)</TD></TR>
            <TR><TD CELLPADDING="2">name</TD><TD ALIGN="LEFT">String(255) (NN)</TD></TR>
            <TR><TD CELLPADDING="2">description</TD><TD ALIGN="LEFT">Text</TD></TR>
            <TR><TD PORT="user_id" CELLPADDING="2">user_id</TD><TD ALIGN="LEFT">Integer (FK, NN)</TD></TR>
            <TR><TD CELLPADDING="2">is_public</TD><TD ALIGN="LEFT">Boolean (Default False)</TD></TR>
            <TR><TD CELLPADDING="2">cover_image_url</TD><TD ALIGN="LEFT">String(500)</TD></TR>
            <TR><TD CELLPADDING="2">created_at</TD><TD ALIGN="LEFT">DateTime (Default UTC Now)</TD></TR>
            <TR><TD CELLPADDING="2">updated_at</TD><TD ALIGN="LEFT">DateTime (Default UTC Now)</TD></TR>
        </TABLE>>];

    PlaylistTrack [label=<
        <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
            <TR><TD COLSPAN="2" BGCOLOR="#E91E63"><FONT COLOR="WHITE">PlaylistTrack</FONT></TD></TR>
            <TR><TD PORT="id" CELLPADDING="2">id</TD><TD ALIGN="LEFT">Integer (PK, Index)</TD></TR>
            <TR><TD PORT="playlist_id" CELLPADDING="2">playlist_id</TD><TD ALIGN="LEFT">Integer (FK, NN)</TD></TR>
            <TR><TD PORT="track_id" CELLPADDING="2">track_id</TD><TD ALIGN="LEFT">Integer (FK, NN)</TD></TR>
            <TR><TD CELLPADDING="2">position</TD><TD ALIGN="LEFT">Integer (NN)</TD></TR>
            <TR><TD CELLPADDING="2">added_at</TD><TD ALIGN="LEFT">DateTime (Default UTC Now)</TD></TR>
        </TABLE>>];

    ListeningHistory [label=<
        <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
            <TR><TD COLSPAN="2" BGCOLOR="#673AB7"><FONT COLOR="WHITE">ListeningHistory</FONT></TD></TR>
            <TR><TD PORT="id" CELLPADDING="2">id</TD><TD ALIGN="LEFT">BigInteger (PK, Index)</TD></TR>
            <TR><TD PORT="user_id" CELLPADDING="2">user_id</TD><TD ALIGN="LEFT">Integer (FK, NN)</TD></TR>
            <TR><TD PORT="track_id" CELLPADDING="2">track_id</TD><TD ALIGN="LEFT">Integer (FK, NN)</TD></TR>
            <TR><TD CELLPADDING="2">played_at</TD><TD ALIGN="LEFT">DateTime (Default UTC Now, Index)</TD></TR>
            <TR><TD CELLPADDING="2">play_duration_ms</TD><TD ALIGN="LEFT">Integer</TD></TR>
            <TR><TD CELLPADDING="2">completion_percentage</TD><TD ALIGN="LEFT">Float</TD></TR>
            <TR><TD CELLPADDING="2">source</TD><TD ALIGN="LEFT">String(50)</TD></TR>
            <TR><TD CELLPADDING="2">device_type</TD><TD ALIGN="LEFT">String(50)</TD></TR>
        </TABLE>>];

    UserPreference [label=<
        <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
            <TR><TD COLSPAN="2" BGCOLOR="#795548"><FONT COLOR="WHITE">UserPreference</FONT></TD></TR>
            <TR><TD PORT="id" CELLPADDING="2">id</TD><TD ALIGN="LEFT">Integer (PK, Index)</TD></TR>
            <TR><TD PORT="user_id" CELLPADDING="2">user_id</TD><TD ALIGN="LEFT">Integer (FK, NN)</TD></TR>
            <TR><TD PORT="genre_id" CELLPADDING="2">genre_id</TD><TD ALIGN="LEFT">Integer (FK)</TD></TR>
            <TR><TD PORT="artist_id" CELLPADDING="2">artist_id</TD><TD ALIGN="LEFT">Integer (FK)</TD></TR>
            <TR><TD CELLPADDING="2">preference_score</TD><TD ALIGN="LEFT">Float</TD></TR>
            <TR><TD CELLPADDING="2">created_at</TD><TD ALIGN="LEFT">DateTime (Default UTC Now)</TD></TR>
            <TR><TD CELLPADDING="2">updated_at</TD><TD ALIGN="LEFT">DateTime (Default UTC Now)</TD></TR>
        </TABLE>>];

    // Отношения
    User:id -> Artist:user_id [label="1:1 (user_profile)"];
    User:id -> Playlist:user_id [label="1:N"];
    User:id -> ListeningHistory:user_id [label="1:N"];
    User:id -> UserPreference:user_id [label="1:N"];

    Artist:id -> Album:artist_id [label="1:N"];
    Artist:id -> Track:artist_id [label="1:N"];
    Artist:id -> UserPreference:artist_id [label="1:N"];

    Album:id -> Track:album_id [label="1:N"];

    Genre:id -> Track:genre_id [label="1:N"];
    Genre:id -> UserPreference:genre_id [label="1:N"];

    Track:id -> ListeningHistory:track_id [label="1:N"];
    Track:id -> PlaylistTrack:track_id [label="1:N"];

    Playlist:id -> PlaylistTrack:playlist_id [label="1:N"];
} 